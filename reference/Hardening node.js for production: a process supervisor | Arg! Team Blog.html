<!DOCTYPE html>
<!--[if IEMobile 7 ]><html id="blaskan" class="no-js iem7" dir="ltr" lang="en-US"><![endif]-->
<!--[if lt IE 7 ]><html id="blaskan" class="no-js ie6" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 7 ]><html id="blaskan" class="no-js ie7" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 8 ]><html id="blaskan" class="no-js ie8" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 9 ]><html id="blaskan" class="no-js ie9" dir="ltr" lang="en-US"><![endif]-->
<!--[if (gt IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html id="blaskan" class=" js no-flexbox canvas canvastext no-webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" dir="ltr" lang="en-US"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>Hardening node.js for production: a process supervisor | Arg! Team Blog</title>
	
		<style type="text/css">
		/**
		 * Bulletproof syntax:
		 * http://www.fontspring.com/blog/further-hardening-of-the-bulletproof-syntax
		 * Font files generated by Font Squirrel:
		 * http://www.fontsquirrel.com
		 * License: Open Font License. See http://blog.argteam.com/wp-content/themes/blaskan/OFL.txt.
		 */
		@font-face {
			font-family: 'LeagueGothic';
			src: url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.eot'); /* IE9 Compat Modes */
			src: url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.eot?iefix') format('eot'), /* IE6-IE8 */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.woff') format('woff'), /* Modern Browsers */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.ttf')  format('truetype'), /* Safari, Android, iOS */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.svg#webfont3nLbXkSC') format('svg'); /* Legacy iOS */
		}
		</style>
		<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Feed" href="http://blog.argteam.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Comments Feed" href="http://blog.argteam.com/comments/feed/">

			<script src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/a_002.html" async=""></script><script async="" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/cbgapi.loaded_0"></script><script src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/all.js" id="facebook-jssdk"></script><script src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
			// Google Analytics for WordPress by Yoast v4.2.5 | http://yoast.com/wordpress/google-analytics/
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-25938904-1']);
							_gaq.push(['_trackPageview']);
			(function () {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();
			//]]></script>
			<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Hardening node.js for production: a process supervisor Comments Feed" href="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/feed/">
<link rel="stylesheet" id="blaskan-framework-css" href="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/framework.css" type="text/css" media="screen">
<link rel="stylesheet" id="blaskan-style-css" href="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/style.css" type="text/css" media="screen">
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/modernizr.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/jquery.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/jquery_002.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/helper.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var objectL10n = {"blaskan_navigation_title":"- Navigation -"};
/* ]]> */
</script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/script.js"></script>
<link rel="prev" title="Connection Pooling with node-postgres" href="http://blog.argteam.com/coding/connection-pooling-with-node-postgres/">
<link rel="next" title="Silly Face Society – The Menu" href="http://blog.argteam.com/sillyfacesociety/silly-face-society-the-menu/">
<link rel="canonical" href="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/">
<link rel="shortlink" href="http://blog.argteam.com/?p=66">
<script charset="utf-8" type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'wp.ed3d2e2e-e1f3-4bd1-b15f-d64d8edf9321'});var st_type='wordpress3.4.1';</script><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">
<link rel="pingback" href="http://blog.argteam.com/xmlrpc.php">
<link href="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/shCore.css" type="text/css" rel="stylesheet"><link href="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/shThemeDefault.css" type="text/css" rel="stylesheet"><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3">
	<script src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/embed.js" async="" type="text/javascript"></script><script src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/checkOAuth.esi" type="text/javascript"></script><link href="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/buttons.css" type="text/css" rel="stylesheet"><script src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/getCount2.html" type="text/javascript"></script><script gapi_processed="true" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/plusone.js" type="text/javascript"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border-spacing:0;border:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
/* @noflip */
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
/* @noflip */
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
/* @noflip */
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
/* @noflip */
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;left:-10000px;overflow:visible;position:absolute;top:-10000px;width:100%
}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0 0, 0 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0 0, 0 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}
.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_fluid span{width:100%}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
/* @noflip */
.fbpluginrecommendationsbarleft{left:10px}
/* @noflip */
.fbpluginrecommendationsbarright{right:10px}</style><script charset="UTF-8" async="" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/alfie.js"></script></head>
<body onclick="if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100);}" class="single single-post postid-66 single-format-standard header-image no-menu content-wide sidebar content-wide-sidebar">
<div id="site">
	<div id="wrapper">
		<header id="header" role="banner">
		  <figure><a href="http://blog.argteam.com/" title="Arg! Team Blog" rel="home"><img src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/cropped-sfs_fb.png" alt="Arg! Team Blog" height="160" width="830"></a></figure><div id="site-name"><a href="http://blog.argteam.com/" title="Arg! Team Blog" rel="home">Arg! Team Blog</a></div><div id="header-message"><a href="http://www.argteam.com/">Arg! Team</a>: purveyors of the finest <a href="http://www.sillyfacesociety.com/">silly faces</a>.</div>		</header>
		<!-- / #header -->
				
		<section id="content" role="main">
			

	
			
		<article id="post-66" class="post-66 post type-post status-publish format-standard hentry category-coding category-node-js category-sillyfacesociety">
			<header>
								
			  				  <time datetime="2012-06-24T19:00:22+00:00" pubdate="">June 24, 2012</time>
								
									<h1>Hardening node.js for production: a process supervisor</h1>
							</header>
		
			<div class="content">
				<p>This post outlines a basic process supervisor for node.js that 
can be used to manage multiple PIDs underneath the same application. It 
contains sample code for our <code>child_monitor</code> with a deep health check for socket servers.</p>
<p>We started using node.js in the <a href="http://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">Silly Face Society</a>
 because it seemed like the quickest way to get a (true, not web) socket
 server up for our “party mode”. The party mode is stateful chat+game 
server where a set of processes check into redis to advertise themselves
 as available to host games (in another post I’ll expand on this 
architecture). For development, node.js was a wonderful way to get a 
prototype out the door but as our launch approaches are getting nervous 
the robustness of node.js in production. This is especially noticeable 
when you tread off the beaten path of HTTP.</p>
<p>To begin: keeping our servers up is <strong>hard</strong>. Whenever a
 node.js error is unhandled, it unwinds the stack and leaves v8 in an 
unrecoverable state. The only recovery is to restart the process. There 
are few modules that help and <a href="https://github.com/nodejitsu/forever" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">forever</a> seems to be the most popular. However, using <code>forever</code>
 won’t allow us to easily manage a set of child processes that fail 
independently, nor will it give us deep health checks. In the Silly Face
 Society’s party mode, each process has a set of game rooms and users in
 the same room must connect to the same process. For multi-core 
utilization we run separate processes (i.e. distinct PIDs) on the same 
host that listen on different ports for socket connections. To supervise
 these processes we have a script called <code>child_monitor</code> that handles logging, health checks and restarts across multiple PIDs.</p>
<p>Before we get to code, a couple of things to note:</p>
<ul>
<li> <code>forever</code> could be used to manage the <code>child_monitor</code>, although I prefer using Ubuntu’s <a href="http://upstart.ubuntu.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://upstart.ubuntu.com']);">upstart</a> for this purpose.
</li><li> The <a href="http://nodejs.org/api/cluster.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://nodejs.org']);">cluster</a> API isn’t applicable. Our traffic is routed to specific processes based on the game and thus can’t be load balanced.
</li><li> By capturing exits of child processes, you can perform some recovery tasks for unhandled exceptions in a safe v8 process.
</li></ul>
<p>Here is <code>child_process.coffee</code> and a detailed walkthrough:</p>
<div><div id="highlighter_197190" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript keyword">{</code><code class="coffeescript plain">_</code><code class="coffeescript keyword">}</code> <code class="coffeescript keyword">=</code> <code class="coffeescript plain">require </code><code class="coffeescript string">'underscore'</code></div><div class="line number2 index1 alt1"><code class="coffeescript variable bold">child_process </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">require </code><code class="coffeescript string">'child_process'</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="coffeescript variable bold">healthCheckInterval </code><code class="coffeescript keyword">=</code> <code class="coffeescript value">60</code> <code class="coffeescript keyword">*</code> <code class="coffeescript value">1000</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="coffeescript variable bold">delayTimeout </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">ms, func</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code> <code class="coffeescript plain">setTimeout func, ms </code><code class="coffeescript comments">#make setTimeout drink coffee</code></div><div class="line number7 index6 alt2"><code class="coffeescript variable bold">exports.spawnMonitoredChild </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">script, port, healthCheck, environmentVariables</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number8 index7 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript variable bold">respawn </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number9 index8 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">child </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">child_process.spawn process.execPath, </code><code class="coffeescript keyword">[</code><code class="coffeescript plain">script</code><code class="coffeescript keyword">]</code><code class="coffeescript plain">,</code></div><div class="line number10 index9 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">env: _.extend</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">environmentVariables, process.env</code><code class="coffeescript keyword">)</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.log </code><code class="coffeescript string">"Started child, port=#{port}, pid=#{child.pid}"</code></div><div class="line number13 index12 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">child.stdout.pipe process.stdout</code></div><div class="line number14 index13 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">child.stderr.pipe process.stderr</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">healthCheckTimeout </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">null</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">delayedHealthCheck </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number19 index18 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">healthCheckTimeout </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">delayTimeout healthCheckInterval, </code><code class="coffeescript keyword">-&gt;</code></div><div class="line number20 index19 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">start </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">new</code> <code class="coffeescript plain">Date</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number21 index20 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">healthCheck port, </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">healthy</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number22 index21 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">if</code> <code class="coffeescript plain">healthy</code></div><div class="line number23 index22 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.log </code><code class="coffeescript string">"#{port} is healthy - ping time #{new Date() - start}ms"</code></div><div class="line number24 index23 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">delayedHealthCheck</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number25 index24 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">else</code></div><div class="line number26 index25 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.error </code><code class="coffeescript string">"#{port} did not respond in time - killing it"</code></div><div class="line number27 index26 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">child.kill</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">child.on </code><code class="coffeescript string">'exit'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">code, signal</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number30 index29 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">clearTimeout healthCheckTimeout</code></div><div class="line number31 index30 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.error </code><code class="coffeescript string">"Child exited with code #{code}, signal #{signal}, respawning"</code></div><div class="line number32 index31 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">respawn</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">delayedHealthCheck</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number35 index34 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">respawn</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>Also available as part of this <a href="https://gist.github.com/2985844" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://gist.github.com']);">gist</a> on github. </p>
<p>First, the method signature:</p>
<div><div id="highlighter_452276" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">spawnMonitoredChild </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">script, port, healthCheck, environmentVariables</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div></div></td></tr></tbody></table></div></div>
<p><code>spawnMonitoredChild</code> accepts a <code>script</code> path (i.e. the node.js script you want to spawn), the <code>port</code> of the child (for disambiguation in logging statements and for the healthcheck), a deep <code>healthCheck</code> function and a set of environment variables. <code>environmentVariables</code> can be used to provide variables downwards, e.g. the environment (prod/development) or the child’s port.</p>
<p>The implementation of <code>spawnMonitoredChild</code> declares the <code>respawn</code> function, and then calls <code>respawn()</code> to bootstrap the respawn cycle. <code>respawn</code> is where the magic happens – it starts up the subprocess and performs periodic health checks:</p>
<div><div id="highlighter_85977" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">child </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">child_process.spawn process.execPath, </code><code class="coffeescript keyword">[</code><code class="coffeescript plain">script</code><code class="coffeescript keyword">]</code><code class="coffeescript plain">,</code></div><div class="line number2 index1 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">env: _.extend</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">environmentVariables, process.env</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>This uses node’s standard <code>child_process</code> module’s <a href="http://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://nodejs.org']);">spawn</a> to bring up another instance of v8 (<code>process.execPath</code>) pointing at our child script (<code>[script]</code> are the arguments to the <code>node</code> or <code>coffee</code> scripts). </p>
<p><code>spawn</code> is used instead of <a href="http://nodejs.org/api/child_process.html#child_process_child_process_fork_modulepath_args_options" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://nodejs.org']);">fork</a> because <code>spawn</code> allows capture of the child process’ standard error / standard out.</p>
<p><code>respawn</code> then proceeds to child process management. First, it takes care of its stderr and stdout:</p>
<div><div id="highlighter_251557" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript plain">child.stdout.pipe process.stdout</code></div><div class="line number2 index1 alt1"><code class="coffeescript plain">child.stderr.pipe process.stderr</code></div></div></td></tr></tbody></table></div></div>
<p>The above code redirects the child stdout/stderr to that of the 
supervisor. In our actual production deployment, I instead capture the 
output streams and log to <a href="https://github.com/flatiron/winston" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">winston</a> using a statement like this:</p>
<div><div id="highlighter_986593" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript plain">child.stderr.on </code><code class="coffeescript string">'data'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">data</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code> <code class="coffeescript plain">winston.fatal </code><code class="coffeescript string">"ERROR from child #{port}: #{data}"</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>winston is configured to send me an e-mail whenever a fatal occurs. 
Usually, winston’s e-mail mechanism can’t be run in the child process 
after an uncaught exception has occurred. Logging underneath the <code>child_monitor</code> supervisor skirts around this issue.</p>
<p>Moving on, we get to <code>delayedHealthCheck</code>. In a loop (i.e., recursively on callback) it calls the provided the provided <code>healthCheck</code> function. If the check ever fails, it kills the child process and bails on further health checks.</p>
<p>Finally, there is the exit handler for the subprocess:
</p><div><div id="highlighter_946213" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript plain">child.on </code><code class="coffeescript string">'exit'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">code, signal</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>The code here will explain itself: whenever the child process exits, it calls up to our respawn and logs a fatal.</p>
<p>That’s it! However, it wouldn’t be much of an example without sample 
use. Here is the healthChecker / spawn code for our “party mode” socket 
server:</p>
<div><div id="highlighter_200667" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">healthCheck </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">port, cb</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number2 index1 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript variable bold">c </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">net.connect port, </code><code class="coffeescript string">'localhost'</code></div><div class="line number3 index2 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">c.setEncoding </code><code class="coffeescript string">"utf8"</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript variable bold">gotAuth </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">false</code></div><div class="line number6 index5 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">c.on </code><code class="coffeescript string">'data'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">data</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number7 index6 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">d </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">null</code></div><div class="line number8 index7 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">try</code></div><div class="line number9 index8 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">d </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">JSON.parse</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">data</code><code class="coffeescript keyword">)</code></div><div class="line number10 index9 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">catch</code> <code class="coffeescript plain">error</code></div><div class="line number11 index10 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">c.end</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number12 index11 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.error </code><code class="coffeescript string">"Health check failed: bad initial response, #{data}"</code></div><div class="line number13 index12 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">return</code> <code class="coffeescript plain">cb</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">false</code><code class="coffeescript keyword">)</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">if</code> <code class="coffeescript keyword">!</code><code class="coffeescript plain">gotAuth</code></div><div class="line number16 index15 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">if</code> <code class="coffeescript variable bold">d.cmd </code><code class="coffeescript keyword">==</code> <code class="coffeescript string">"PLSAUTH"</code></div><div class="line number17 index16 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">gotAuth </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">true</code></div><div class="line number18 index17 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">c.write JSON.stringify</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">{</code><code class="coffeescript plain">cmd:</code><code class="coffeescript string">"RING"</code><code class="coffeescript keyword">}</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">+</code> <code class="coffeescript string">"\r\n"</code></div><div class="line number19 index18 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">else</code></div><div class="line number20 index19 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">c.end</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number21 index20 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.error </code><code class="coffeescript string">"Health check failed: bad initial response, #{data}"</code></div><div class="line number22 index21 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">return</code> <code class="coffeescript plain">cb</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">false</code><code class="coffeescript keyword">)</code></div><div class="line number23 index22 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">else</code></div><div class="line number24 index23 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">c.end</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number25 index24 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.info </code><code class="coffeescript string">"Health check response"</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">{</code><code class="coffeescript plain">res: d</code><code class="coffeescript keyword">}</code></div><div class="line number26 index25 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">return</code> <code class="coffeescript plain">cb</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">true</code><code class="coffeescript keyword">)</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">c.on </code><code class="coffeescript string">'error'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">e</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number29 index28 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.error </code><code class="coffeescript string">"Health check failed: error connecting #{e}"</code></div><div class="line number30 index29 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">cb</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">false</code><code class="coffeescript keyword">)</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">c.setTimeout config.healthCheckTimeout, </code><code class="coffeescript keyword">-&gt;</code> <code class="coffeescript plain">c.destroy</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="coffeescript variable bold">numWorkers </code><code class="coffeescript keyword">=</code> <code class="coffeescript value">2</code></div><div class="line number35 index34 alt2"><code class="coffeescript variable bold">startPort </code><code class="coffeescript keyword">=</code> <code class="coffeescript value">31337</code></div><div class="line number36 index35 alt1"><code class="coffeescript keyword">for</code> <code class="coffeescript plain">i </code><code class="coffeescript keyword">in</code> <code class="coffeescript keyword">[</code><code class="coffeescript value">0</code><code class="coffeescript plain">..numWorkers</code><code class="coffeescript keyword">-</code><code class="coffeescript value">1</code><code class="coffeescript keyword">]</code></div><div class="line number37 index36 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript variable bold">port </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">startPort </code><code class="coffeescript keyword">+</code> <code class="coffeescript plain">i</code></div><div class="line number38 index37 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">child_monitor.spawnMonitoredChild </code><code class="coffeescript string">'./lib/sfs_socket'</code><code class="coffeescript plain">, port, healthCheck,</code></div><div class="line number39 index38 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">SFS_SOCKET_PORT: port</code></div><div class="line number40 index39 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">SFS_SOCKET_HOST: socketHost</code></div></div></td></tr></tbody></table></div></div>
<p>The details aren’t too important. The <code>healthCheck</code> just connects to the local server and sends a <em>RING</em> command. The socket server is supposed to send <em>AHOY-HOY</em> as a response. Don’t ask.</p>
<p>Beyond sockets, we also use <code>child_monitor</code> to manage a set of <a href="http://expressjs.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://expressjs.com']);">express.js</a>
 instances that serve our HTTP actions. By listening on different ports 
we are able to throw nginx in front as load balancer, http cache and 
static file host. <code>child_monitor</code> ensures that our backend 
servers are always available for nginx to call down. I’ll try to make a 
follow up post with the full details.</p>
<p>One final tip: killing the <code>child_process</code> supervisor should also take down its child processes. A Linux-only <code>prctl</code> system call in the child process will handle this for you. Add this to the top of your child script:</p>
<div><div id="highlighter_697890" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">FFI </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">require</code><code class="coffeescript keyword">(</code><code class="coffeescript string">'node-ffi'</code><code class="coffeescript keyword">)</code></div><div class="line number2 index1 alt1"><code class="coffeescript variable bold">current </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">new</code> <code class="coffeescript plain">FFI.Library</code><code class="coffeescript keyword">(</code><code class="coffeescript plain">null, </code><code class="coffeescript keyword">{</code><code class="coffeescript string">"prctl"</code><code class="coffeescript plain">: </code><code class="coffeescript keyword">[</code><code class="coffeescript string">"int32"</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">[</code><code class="coffeescript string">"int32"</code><code class="coffeescript plain">, </code><code class="coffeescript string">"uint32"</code><code class="coffeescript keyword">]</code><code class="coffeescript keyword">]</code><code class="coffeescript keyword">}</code><code class="coffeescript keyword">)</code></div><div class="line number3 index2 alt2"><code class="coffeescript plain">current.prctl</code><code class="coffeescript keyword">(</code><code class="coffeescript value">1</code><code class="coffeescript plain">,</code><code class="coffeescript value">15</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>Naturally, I stole the <code>prctl</code> bit from <a href="http://stackoverflow.com/questions/5541288/node-js-detect-when-parent-process-exits" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://stackoverflow.com']);">this stackoverflow post</a>. </p>
<p>For the latest version of this code, see the <a href="https://gist.github.com/2985844" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://gist.github.com']);">gist</a> on github. </p>
<p><span st_processed="yes" class="st_facebook_hcount" st_title="Hardening node.js for production: a process supervisor" st_url="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/" displaytext="facebook"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/facebook_counter.png&quot;);" class="stMainServices st-facebook-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">0</span></span></span></span></span></span><span st_processed="yes" st_via="cosbynator" class="st_twitter_hcount" st_title="Hardening node.js for production: a process supervisor" st_url="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/" displaytext="twitter"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/twitter_counter.png&quot;);" class="stMainServices st-twitter-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">184</span></span></span></span></span></span><span st_processed="yes" class="st_email_hcount" st_title="Hardening node.js for production: a process supervisor" st_url="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/" displaytext="email"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/email_counter.png&quot;);" class="stMainServices st-email-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">0</span></span></span></span></span></span><span st_processed="yes" class="st_plusone_hcount" st_title="Hardening node.js for production: a process supervisor" st_url="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/" displaytext="plusone"><div style="display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:75px; height:21px;">&nbsp;<div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px;"><iframe title="+1" data-gapiattached="true" allowtransparency="true" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/fastbutton.html" name="I0_1367964564466" id="I0_1367964564466" vspace="0" tabindex="0" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" marginwidth="0" marginheight="0" hspace="0" frameborder="0" scrolling="no" width="100%"></iframe></div></div></span><span st_processed="yes" class="st_fblike_hcount" st_title="Hardening node.js for production: a process supervisor" st_url="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/" displaytext="fblike"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;padding:0px;font-size:11px;line-height:16px;vertical-align:bottom;overflow:visible;"><div fb-xfbml-state="rendered" data-href="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/" class="fb-like fb_edge_widget_with_comment fb_iframe_widget" data-show-faces="false" data-layout="button_count" data-send="false" data-action=""><span style="height: 21px; width: 73px;"><iframe src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/like.html" class="fb_ltr" title="Like this content on Facebook." style="border: medium none; overflow: hidden; height: 21px; width: 73px;" name="f13da264be268c4" id="f187f8189204592" scrolling="no"></iframe></span></div></span></span></p>					
					
			</div>
			<!-- / .content -->
			
			<footer>
			  				  <span class="author"><span class="author-label">Written by</span> <a href="http://blog.argteam.com/author/thomas-dimson/" title="Posts by Thomas Dimson" rel="author">Thomas Dimson</a></span>
																	<span class="categories">
						<span class="categories-label">Posted in</span> <a href="http://blog.argteam.com/category/coding/" title="View all posts in coding" rel="category tag">coding</a>, <a href="http://blog.argteam.com/category/node-js/" title="View all posts in node.js" rel="category tag">node.js</a>, <a href="http://blog.argteam.com/category/sillyfacesociety/" title="View all posts in SillyFaceSociety" rel="category tag">SillyFaceSociety</a>					</span>
												
							</footer>
		</article>
		<!-- / #post-66 -->

		
<div id="disqus_thread"><iframe verticalscrolling="no" horizontalscrolling="no" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/a.html" style="width: 100%; border: medium none; overflow: hidden; height: 1128px;" role="complementary" allowtransparency="true" data-disqus-uid="1" id="dsq1" frameborder="0" scrolling="no" width="100%"></iframe><iframe src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/client.html" style="width: 100%; border: medium none; overflow: hidden; display: none;" role="application" allowtransparency="true" data-disqus-uid="2" id="dsq2" frameborder="0" width="100%"></iframe></div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/';
    var disqus_identifier = '66 http://blog.argteam.com/?p=66';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'argteamblog';
    var disqus_title = "Hardening node.js for production: a process supervisor";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=66';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
    var facebookXdReceiverPath = 'http://blog.argteam.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
            {
                'author_name':    "Hardening node.js for production: a process supervisor | node web programming | Scoop.it",
                'author_url':    "http:\/\/www.scoop.it\/t\/node-web-programming\/p\/2141969354\/hardening-node-js-for-production-a-process-supervisor",
                'date':            "07\/09\/2012 07:50 PM",
                'excerpt':        "[...] This post outlines a basic process supervisor for node.js that can be used to manage multiple PIDs underneath the ...",
                'type':            "pingback"            }
,            {
                'author_name':    "Hardening node.js for production: a process supervisor | Arg! Team Blog | kernicPanel | Scoop.it",
                'author_url':    "http:\/\/www.scoop.it\/t\/kernicpanel\/p\/2146143949\/hardening-node-js-for-production-a-process-supervisor-arg-team-blog",
                'date':            "07\/10\/2012 01:25 PM",
                'excerpt':        "[...] This post outlines a basic process supervisor for node.js that can be used to manage multiple PIDs underneath the ...",
                'type':            "pingback"            }
,            {
                'author_name':    "Hardening node.js for production part 3: zero downtime deployments with nginx | Arg! Team Blog",
                'author_url':    "http:\/\/blog.argteam.com\/coding\/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx\/",
                'date':            "09\/21\/2012 11:17 AM",
                'excerpt':        "[...] is part of our series on hardening node.js for production use in the Silly Face Society &#8211; see part ...",
                'type':            "pingback"            }
        ],
        'trackback_url': "http:\/\/blog.argteam.com\/coding\/hardening-nodejs-production-process-supervisor\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
        dsq.src = 'http' + '://' + disqus_shortname + '.' + 'disqus.com' + '/embed.js?pname=wordpress&pver=2.73';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
		
				  <nav class="post-nav" role="navigation">
				<div class="nav-previous"><a href="http://blog.argteam.com/coding/connection-pooling-with-node-postgres/" rel="prev"><span class="meta-nav"></span> Connection Pooling with node-postgres</a></div>
				<div class="nav-next"><a href="http://blog.argteam.com/sillyfacesociety/silly-face-society-the-menu/" rel="next">Silly Face Society – The Menu <span class="meta-nav"></span></a></div>
			</nav>
			<!-- / .post-nav -->
				
		

		</section>
		<!-- / #content -->
		
		
					<aside id="primary" role="complementary">
				<section id="text-4" class="widget widget_text">			<div class="textwidget"><a href="http://blog.argteam.com/feed/">Feed</a>
<br>
<br>
<a href="http://www.twitter.com/cosbynator" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.twitter.com']);">@cosbynator</a>
<br>
<a href="http://www.twitter.com/_toastar" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.twitter.com']);">@_toastar</a></div>
		</section><section id="archives-3" class="widget widget_archive"><h3 class="title">Oldies</h3>		<ul>
			<li><a href="http://blog.argteam.com/2012/10/" title="October 2012">October 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/09/" title="September 2012">September 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/08/" title="August 2012">August 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/07/" title="July 2012">July 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/06/" title="June 2012">June 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/01/" title="January 2012">January 2012</a></li>
	<li><a href="http://blog.argteam.com/2011/12/" title="December 2011">December 2011</a></li>
	<li><a href="http://blog.argteam.com/2011/11/" title="November 2011">November 2011</a></li>
		</ul>
</section>		</aside>
		<!-- / #primary -->
    			
		
		<footer id="footer">
			<div id="footer-info" role="contentinfo"><div id="footer-message">Route complaints to <a href="https://twitter.com/cosbynator">@cosbynator</a> or <a href="https://twitter.com/_toastar">@_toastar</a></div><div id="footer-credits">Powered by <a href="http://www.blaskan.net/">Blaskan</a> and <a href="http://www.wordpress.org/">WordPress</a>.</div></div>		</footer>
		<!-- / #footer -->
	</div>
	<!-- / #wrapper -->
</div>
<!-- / #site -->


	<script>
	MBP.scaleFix();
	MBP.hideUrlBar();
	</script>
	<!--[if (lt IE 9) & (!IEMobile)]>
<script type="text/javascript" src="http://blog.argteam.com/wp-content/themes/blaskan/js/libs/selectivizr.1.0.3b.js"></script>
<script type="text/javascript" src="http://blog.argteam.com/wp-content/themes/blaskan/js/libs/respond.min.js"></script>
<![endif]-->
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/shCore.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/shBrushCoffeeScript.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://blog.argteam.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://blog.argteam.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['tab-size'] = 2;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/comment-reply.js"></script>


<iframe style="display:none;" src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/getSegment.html" name="stSegmentFrame" id="stSegmentFrame" frameborder="0" height="0px" scrolling="no" width="0px"></iframe><div style="visibility: hidden; top: -999px; left: -999px;" class="stwrapper" id="stwrapper"><div class="stclose"></div><iframe src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/index.html" style="top: 0px; left: 0px;" name="stLframe" class="stLframe" id="stLframe" allowtransparency="true" frameborder="0" height="350px" scrolling="no" width="353px"></iframe></div><div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/xd_arbiter.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_http" allowtransparency="true" name="fb_xdm_frame_http" frameborder="0" scrolling="no"></iframe><iframe src="Hardening%20node.js%20for%20production:%20a%20process%20supervisor%20%7C%20Arg%21%20Team%20Blog_files/xd_arbiter_002.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" allowtransparency="true" name="fb_xdm_frame_https" frameborder="0" scrolling="no"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div></body></html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced
Database Caching 1/24 queries in 0.015 seconds using disk: basic

Served from: blog.argteam.com @ 2013-05-07 13:48:39 -->