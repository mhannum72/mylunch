<!DOCTYPE html>
<!--[if IEMobile 7 ]><html id="blaskan" class="no-js iem7" dir="ltr" lang="en-US"><![endif]-->
<!--[if lt IE 7 ]><html id="blaskan" class="no-js ie6" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 7 ]><html id="blaskan" class="no-js ie7" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 8 ]><html id="blaskan" class="no-js ie8" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 9 ]><html id="blaskan" class="no-js ie9" dir="ltr" lang="en-US"><![endif]-->
<!--[if (gt IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html id="blaskan" class=" js no-flexbox canvas canvastext no-webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" dir="ltr" lang="en-US"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>Hardening node.js for production part 3: zero downtime deployments with nginx | Arg! Team Blog</title>
	
		<style type="text/css">
		/**
		 * Bulletproof syntax:
		 * http://www.fontspring.com/blog/further-hardening-of-the-bulletproof-syntax
		 * Font files generated by Font Squirrel:
		 * http://www.fontsquirrel.com
		 * License: Open Font License. See http://blog.argteam.com/wp-content/themes/blaskan/OFL.txt.
		 */
		@font-face {
			font-family: 'LeagueGothic';
			src: url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.eot'); /* IE9 Compat Modes */
			src: url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.eot?iefix') format('eot'), /* IE6-IE8 */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.woff') format('woff'), /* Modern Browsers */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.ttf')  format('truetype'), /* Safari, Android, iOS */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.svg#webfont3nLbXkSC') format('svg'); /* Legacy iOS */
		}
		</style>
		<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Feed" href="http://blog.argteam.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Comments Feed" href="http://blog.argteam.com/comments/feed/">

			<script src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/a_002.html" async=""></script><script async="" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/cbgapi.loaded_0"></script><script src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/all.js" id="facebook-jssdk"></script><script src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
			// Google Analytics for WordPress by Yoast v4.2.5 | http://yoast.com/wordpress/google-analytics/
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-25938904-1']);
							_gaq.push(['_trackPageview']);
			(function () {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();
			//]]></script>
			<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Hardening node.js for production part 3: zero downtime deployments with nginx Comments Feed" href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/feed/">
<link rel="stylesheet" id="blaskan-framework-css" href="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/framework.css" type="text/css" media="screen">
<link rel="stylesheet" id="blaskan-style-css" href="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/style.css" type="text/css" media="screen">
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/modernizr.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/jquery.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/jquery_002.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/helper.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var objectL10n = {"blaskan_navigation_title":"- Navigation -"};
/* ]]> */
</script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/script.js"></script>
<link rel="prev" title="Better Effects: 3 Simple iOS 5 Particle Systems by Example" href="http://blog.argteam.com/coding/better-effects-3-simple-ios-5-particle-systems-by-example/">
<link rel="next" title="Release Day" href="http://blog.argteam.com/sillyfacesociety/release-day/">
<link rel="canonical" href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/">
<link rel="shortlink" href="http://blog.argteam.com/?p=374">
<script charset="utf-8" type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'wp.ed3d2e2e-e1f3-4bd1-b15f-d64d8edf9321'});var st_type='wordpress3.4.1';</script><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">
<link rel="pingback" href="http://blog.argteam.com/xmlrpc.php">
<link href="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/shCore.css" type="text/css" rel="stylesheet"><link href="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/shThemeDefault.css" type="text/css" rel="stylesheet"><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3">
	<script src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/embed.js" async="" type="text/javascript"></script><script src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/checkOAuth.esi" type="text/javascript"></script><link href="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/buttons.css" type="text/css" rel="stylesheet"><script src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/getCount2.html" type="text/javascript"></script><script gapi_processed="true" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/plusone.js" type="text/javascript"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border-spacing:0;border:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
/* @noflip */
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
/* @noflip */
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
/* @noflip */
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
/* @noflip */
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;left:-10000px;overflow:visible;position:absolute;top:-10000px;width:100%
}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0 0, 0 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0 0, 0 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}
.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_fluid span{width:100%}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
/* @noflip */
.fbpluginrecommendationsbarleft{left:10px}
/* @noflip */
.fbpluginrecommendationsbarright{right:10px}</style><script charset="UTF-8" async="" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/alfie.js"></script></head>
<body onclick="if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100);}" class="single single-post postid-374 single-format-standard header-image no-menu content-wide sidebar content-wide-sidebar">
<div id="site">
	<div id="wrapper">
		<header id="header" role="banner">
		  <figure><a href="http://blog.argteam.com/" title="Arg! Team Blog" rel="home"><img src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/cropped-sfs_fb.png" alt="Arg! Team Blog" height="160" width="830"></a></figure><div id="site-name"><a href="http://blog.argteam.com/" title="Arg! Team Blog" rel="home">Arg! Team Blog</a></div><div id="header-message"><a href="http://www.argteam.com/">Arg! Team</a>: purveyors of the finest <a href="http://www.sillyfacesociety.com/">silly faces</a>.</div>		</header>
		<!-- / #header -->
				
		<section id="content" role="main">
			

	
			
		<article id="post-374" class="post-374 post type-post status-publish format-standard hentry category-coding category-http category-node-js category-sillyfacesociety">
			<header>
								
			  				  <time datetime="2012-09-21T11:17:15+00:00" pubdate="">September 21, 2012</time>
								
									<h1>Hardening node.js for production part 3: zero downtime deployments with nginx</h1>
							</header>
		
			<div class="content">
				<p>Below I’ll talk about deploying new node.js code for a HTTP 
server without ever suffering downtime. This is part of our series on 
hardening node.js for production use in the <a href="http://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">Silly Face Society</a> – see <a href="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/">part 1</a> and <a href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/">part 2</a>.</p>
<p>Suffering downtime to perform an upgrade always feels a bit 
backwards. We do it because it is too technically complicated relative 
to the expense of an outage. In the <a href="http://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">Silly Face Society</a>,
 I’m willing to suffer brief outages for PostgreSQL and Redis upgrades 
but not for code that we control: our day-to-day bug fixes. Besides bug 
fixes, the frequency of node.js module updates would require an outage 
multiple times a week just to stay fresh.</p>
<p>To solve this, the basic idea using nginx’s built-in failover 
mechanism for upstream servers / processes to shift traffic away from 
processes that are restarting. Each upstream server will allow existing 
connections to finish before shutting down and restarting with the new 
code. We perform a zero downtime upgrade of all processes on the machine
 by by iterating over each process, shutting it down and bringing it 
back up. For the rest of the tutorial, I’ll assume you have nginx set up
 to proxy node requests ala <a href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/">part 2</a> and are using <a href="http://expressjs.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://expressjs.com']);">express.js</a> to handle HTTP requests.</p>
<p>All of this sounds much more complicated than it is, so let’s dive into code:</p>
<h2> Graceful Shutdowns in Express.js </h2>
<p>We will first implement graceful shutdowns of the process. When our 
process receives a kill signal we want it to refuse new connections and 
finish existing ones. I’ll assume you have an express.js server set up 
with something like:</p>
<div><div id="highlighter_194663" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">app </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">express.createServer</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number2 index1 alt1"><code class="coffeescript keyword">...</code></div><div class="line number3 index2 alt2"><code class="coffeescript plain">app.listen</code><code class="coffeescript keyword">(</code><code class="coffeescript value">31337</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>We can modify this slightly to perform graceful shutdowns on SIGTERM.
 Additionally, we’ll create a timeout that forcefully exits the process 
if connections are taking an unreasonable amount of time to close:</p>
<div><div id="highlighter_724326" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">httpServer </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">app.listen</code><code class="coffeescript keyword">(</code><code class="coffeescript value">31337</code><code class="coffeescript keyword">)</code></div><div class="line number2 index1 alt1"><code class="coffeescript plain">process.on </code><code class="coffeescript string">'SIGTERM'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">-&gt;</code></div><div class="line number3 index2 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">console.log </code><code class="coffeescript string">"Received kill signal (SIGTERM), shutting down gracefully."</code></div><div class="line number4 index3 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">httpServer.close </code><code class="coffeescript keyword">-&gt;</code></div><div class="line number5 index4 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.log </code><code class="coffeescript string">"Closed out remaining connections."</code></div><div class="line number6 index5 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">process.exit</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">setTimeout </code><code class="coffeescript keyword">-&gt;</code></div><div class="line number9 index8 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">console.error </code><code class="coffeescript string">"Could not close connections in time, forcefully shutting down"</code></div><div class="line number10 index9 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">process.exit</code><code class="coffeescript keyword">(</code><code class="coffeescript value">1</code><code class="coffeescript keyword">)</code></div><div class="line number11 index10 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">, </code><code class="coffeescript value">30</code><code class="coffeescript keyword">*</code><code class="coffeescript value">1000</code></div></div></td></tr></tbody></table></div></div>
<p>In the above code, we extract the underlying http server object from express.js (the result of the <code>app.listen</code> call). Whenever we receive SIGTERM (the default signal from kill), we attempt a graceful shutdown by calling <code>httpServer.close</code>.
 This puts the server in a mode that refuses new connections but keeps 
existing ones open. If there is a connection hog that doesn’t quit 
within that time period, we perform an immediate exit (<code>setTimeout</code> does this after 30 seconds). Modify this timeout as appropriate. <strong>Note:</strong>
 I don’t use web sockets, but they would be considered connection hogs 
by the above logic. To achieve zero impactful downtime, you would have 
to close out these connections manually and have some nifty retry logic 
on the client. </p>
<p>There is one issue with the code: HTTP 1.1 keep-alive connections 
would also be considered “connection hogs” and continue to accept new <em>requests</em>
 on the same connection. Since I use keep-alive connections in nginx, 
this is a big problem. Ideally we would force node.js into a mode that 
closes all existing idle connections. Unfortunately, I can’t find any 
way of doing this with existing APIs (see <a href="https://groups.google.com/forum/?fromgroups=#%21topic/nodejs/Mn1jzHCGUYE" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://groups.google.com']);">this</a>
 newsgroup discussion). Fortunately, we can add middleware that 
automatically sends 502 errors to new HTTP requests on the server. Nginx
 will handle the rest (see below). Here’s the modification:</p>
<div><div id="highlighter_604394" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">app </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">express.createServer</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div><div class="line number2 index1 alt1"><code class="coffeescript keyword">...</code></div><div class="line number3 index2 alt2"><code class="coffeescript variable bold">gracefullyClosing </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">false</code></div><div class="line number4 index3 alt1"><code class="coffeescript plain">app.use </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">req, res, next</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number5 index4 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript keyword">return</code> <code class="coffeescript plain">next</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">unless</code> <code class="coffeescript plain">gracefullyClosing</code></div><div class="line number6 index5 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">res.setHeader </code><code class="coffeescript string">"Connection"</code><code class="coffeescript plain">, </code><code class="coffeescript string">"close"</code></div><div class="line number7 index6 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">res.send </code><code class="coffeescript value">502</code><code class="coffeescript plain">, </code><code class="coffeescript string">"Server is in the process of restarting"</code></div><div class="line number8 index7 alt1"><code class="coffeescript keyword">...</code></div><div class="line number9 index8 alt2"><code class="coffeescript variable bold">httpServer </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">app.listen</code><code class="coffeescript keyword">(</code><code class="coffeescript value">31337</code><code class="coffeescript keyword">)</code></div><div class="line number10 index9 alt1"><code class="coffeescript plain">process.on </code><code class="coffeescript string">'SIGTERM'</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">-&gt;</code></div><div class="line number11 index10 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;</code><code class="coffeescript variable bold">gracefullyClosing </code><code class="coffeescript keyword">=</code> <code class="coffeescript plain">true</code></div><div class="line number12 index11 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;</code><code class="coffeescript keyword">...</code></div></div></td></tr></tbody></table></div></div>
<p>This should be mostly self-explanatory: we flip a switch that makes every new <em>request</em> stop with a 502 error. We also send a <code>Connection: close</code> header to hint that this socket should be terminated. As usual, this minimal example is <a href="https://gist.github.com/3760055" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://gist.github.com']);">available as a gist</a>.</p>
<h2> Ignoring Restarting Servers in Nginx </h2>
<p>We will assume you have an nginx server with more than one upstream server in a section like:<br>
<code><br>
upstream silly_face_society_upstream {<br>
     server 127.0.0.1:61337;<br>
     server 127.0.0.1:61338;<br>
     keepalive 64;<br>
}<br>
</code></p>
<p>By default, if nginx detects an <em>error</em> (i.e. connection refused) or a <em>timeout</em> on one upstream server, it will fail over to the next upstream server. The full process is explained within the <a href="http://wiki.nginx.org/HttpProxyModule#proxy_next_upstream" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">proxy_next_upstream</a>
 section of the HttpProxy module documentation. The default is 
essentially the behaviour we want, modulo fail-overs on keep-alive 
connections. As mentioned above, we throw a 502 to indicate a graceful 
shutdown in progress. Insert a <code> proxy_next_upstream</code> directive like:<br>
<code><br>
...<br>
location @nodejs {<br>
     ...<br>
     proxy_next_upstream error timeout http_502;<br>
     ...<br>
     proxy_pass         http://silly_face_society_upstream;<br>
}<br>
...<br>
</code></p>
<p>With the above addition nginx will failover to the next upstream whenever it gets an error, timeout or 502 from the current one.</p>
<h2> Performing zero downtime deployments </h2>
<p>Believe it or not, everything is in place to do zero downtime 
deployments. Whenever new code is pushed we have to bounce each process 
individually. To gracefully start the server with new code:</p>
<ol>
<li> Issue a SIGTERM signal (<code>kill &lt;pid&gt;</code> will do that)
</li><li> Wait for termination. As a simplification, wait the kill timeout and a bit of a buffer.
</li><li> Start the process up again.
</li></ol>
<p>That’s it: nginx will handle the hard work of putting traffic on the 
healthy processes! If you are running in a managed environment, you can 
even automate the restarts. I’ve put a new version of my <code>child_monitor.coffee</code> script from <a href="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/">part 1</a> on github <a href="https://gist.github.com/2985844%22%22">as a gist</a>
 to show how you can go about it. The master process listens for a 
SIGHUP (indicating a code push). Whenever it receives the signal, it 
kills+restarts each monitored child with a short waiting period in 
between each kill.</p>
<p>Bingo bango. Ah, I forgot a shameless plug for our upcoming iPhone game: if you like silly faces, visit <a href="http://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">www.sillyfacesociety.com</a> and get the app! It’s <a href="http://www.youtube.com/watch?v=HqP0tGrQEmA" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.youtube.com']);">silltastic</a>!</p>
<p><span st_processed="yes" class="st_facebook_hcount" st_title="Hardening node.js for production part 3: zero downtime deployments with nginx" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/" displaytext="facebook"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/facebook_counter.png&quot;);" class="stMainServices st-facebook-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">28</span></span></span></span></span></span><span st_processed="yes" st_via="cosbynator" class="st_twitter_hcount" st_title="Hardening node.js for production part 3: zero downtime deployments with nginx" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/" displaytext="twitter"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/twitter_counter.png&quot;);" class="stMainServices st-twitter-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">342</span></span></span></span></span></span><span st_processed="yes" class="st_email_hcount" st_title="Hardening node.js for production part 3: zero downtime deployments with nginx" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/" displaytext="email"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/email_counter.png&quot;);" class="stMainServices st-email-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">2</span></span></span></span></span></span><span st_processed="yes" class="st_plusone_hcount" st_title="Hardening node.js for production part 3: zero downtime deployments with nginx" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/" displaytext="plusone"><div style="display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:75px; height:21px;">&nbsp;<div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px;"><iframe title="+1" data-gapiattached="true" allowtransparency="true" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/fastbutton.html" name="I0_1367965647300" id="I0_1367965647300" vspace="0" tabindex="0" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" marginwidth="0" marginheight="0" hspace="0" frameborder="0" scrolling="no" width="100%"></iframe></div></div></span><span st_processed="yes" class="st_fblike_hcount" st_title="Hardening node.js for production part 3: zero downtime deployments with nginx" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/" displaytext="fblike"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;padding:0px;font-size:11px;line-height:16px;vertical-align:bottom;overflow:visible;"><div fb-xfbml-state="rendered" data-href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/" class="fb-like fb_edge_widget_with_comment fb_iframe_widget" data-show-faces="false" data-layout="button_count" data-send="false" data-action=""><span style="height: 21px; width: 73px;"><iframe src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/like.html" class="fb_ltr" title="Like this content on Facebook." style="border: medium none; overflow: hidden; height: 21px; width: 73px;" name="f1e866315a44772" id="f34965abec3004" scrolling="no"></iframe></span></div></span></span></p>					
					
			</div>
			<!-- / .content -->
			
			<footer>
			  				  <span class="author"><span class="author-label">Written by</span> <a href="http://blog.argteam.com/author/thomas-dimson/" title="Posts by Thomas Dimson" rel="author">Thomas Dimson</a></span>
																	<span class="categories">
						<span class="categories-label">Posted in</span> <a href="http://blog.argteam.com/category/coding/" title="View all posts in coding" rel="category tag">coding</a>, <a href="http://blog.argteam.com/category/http/" title="View all posts in http" rel="category tag">http</a>, <a href="http://blog.argteam.com/category/node-js/" title="View all posts in node.js" rel="category tag">node.js</a>, <a href="http://blog.argteam.com/category/sillyfacesociety/" title="View all posts in SillyFaceSociety" rel="category tag">SillyFaceSociety</a>					</span>
												
							</footer>
		</article>
		<!-- / #post-374 -->

		
<div id="disqus_thread"><iframe verticalscrolling="no" horizontalscrolling="no" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/a.html" style="width: 100%; border: medium none; overflow: hidden; height: 1356px;" role="complementary" allowtransparency="true" data-disqus-uid="1" id="dsq1" frameborder="0" scrolling="no" width="100%"></iframe><iframe src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/client.html" style="width: 100%; border: medium none; overflow: hidden; display: none;" role="application" allowtransparency="true" data-disqus-uid="2" id="dsq2" frameborder="0" width="100%"></iframe></div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/';
    var disqus_identifier = '374 http://blog.argteam.com/?p=374';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'argteamblog';
    var disqus_title = "Hardening node.js for production part 3: zero downtime deployments with nginx";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=374';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
    var facebookXdReceiverPath = 'http://blog.argteam.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
            {
                'author_name':    "Hardening node.js for production part 3: zero downtime deployments with nginx | Arg! Team Blog | Modern web development | Scoop.it",
                'author_url':    "http:\/\/www.scoop.it\/t\/modern-web-development\/p\/2762025055\/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx-arg-team-blog",
                'date':            "09\/22\/2012 07:36 AM",
                'excerpt':        "[...] &nbsp; [...] ",
                'type':            "pingback"            }
,            {
                'author_name':    "Hardening node.js for production part 3: zero downtime deployments with nginx | Arg! Team Blog | javascript.js | Scoop.it",
                'author_url':    "http:\/\/www.scoop.it\/t\/javascript-js\/p\/2787990677\/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx-arg-team-blog",
                'date':            "09\/25\/2012 05:54 AM",
                'excerpt':        "[...] Below I&rsquo;ll talk about deploying new node.js code for a HTTP server without ever suffering downtime. This is part ...",
                'type':            "pingback"            }
        ],
        'trackback_url': "http:\/\/blog.argteam.com\/coding\/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
        dsq.src = 'http' + '://' + disqus_shortname + '.' + 'disqus.com' + '/embed.js?pname=wordpress&pver=2.73';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
		
				  <nav class="post-nav" role="navigation">
				<div class="nav-previous"><a href="http://blog.argteam.com/coding/better-effects-3-simple-ios-5-particle-systems-by-example/" rel="prev"><span class="meta-nav"></span> Better Effects: 3 Simple iOS 5 Particle Systems by Example</a></div>
				<div class="nav-next"><a href="http://blog.argteam.com/sillyfacesociety/release-day/" rel="next">Release Day <span class="meta-nav"></span></a></div>
			</nav>
			<!-- / .post-nav -->
				
		

		</section>
		<!-- / #content -->
		
		
					<aside id="primary" role="complementary">
				<section id="text-4" class="widget widget_text">			<div class="textwidget"><a href="http://blog.argteam.com/feed/">Feed</a>
<br>
<br>
<a href="http://www.twitter.com/cosbynator" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.twitter.com']);">@cosbynator</a>
<br>
<a href="http://www.twitter.com/_toastar" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.twitter.com']);">@_toastar</a></div>
		</section><section id="archives-3" class="widget widget_archive"><h3 class="title">Oldies</h3>		<ul>
			<li><a href="http://blog.argteam.com/2012/10/" title="October 2012">October 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/09/" title="September 2012">September 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/08/" title="August 2012">August 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/07/" title="July 2012">July 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/06/" title="June 2012">June 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/01/" title="January 2012">January 2012</a></li>
	<li><a href="http://blog.argteam.com/2011/12/" title="December 2011">December 2011</a></li>
	<li><a href="http://blog.argteam.com/2011/11/" title="November 2011">November 2011</a></li>
		</ul>
</section>		</aside>
		<!-- / #primary -->
    			
		
		<footer id="footer">
			<div id="footer-info" role="contentinfo"><div id="footer-message">Route complaints to <a href="https://twitter.com/cosbynator">@cosbynator</a> or <a href="https://twitter.com/_toastar">@_toastar</a></div><div id="footer-credits">Powered by <a href="http://www.blaskan.net/">Blaskan</a> and <a href="http://www.wordpress.org/">WordPress</a>.</div></div>		</footer>
		<!-- / #footer -->
	</div>
	<!-- / #wrapper -->
</div>
<!-- / #site -->


	<script>
	MBP.scaleFix();
	MBP.hideUrlBar();
	</script>
	<!--[if (lt IE 9) & (!IEMobile)]>
<script type="text/javascript" src="http://blog.argteam.com/wp-content/themes/blaskan/js/libs/selectivizr.1.0.3b.js"></script>
<script type="text/javascript" src="http://blog.argteam.com/wp-content/themes/blaskan/js/libs/respond.min.js"></script>
<![endif]-->
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/shCore.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/shBrushCoffeeScript.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://blog.argteam.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://blog.argteam.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['tab-size'] = 2;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/comment-reply.js"></script>


<iframe style="display:none;" src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/getSegment.html" name="stSegmentFrame" id="stSegmentFrame" frameborder="0" height="0px" scrolling="no" width="0px"></iframe><div style="visibility: hidden; top: -999px; left: -999px;" class="stwrapper" id="stwrapper"><div class="stclose"></div><iframe src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/index.html" style="top: 0px; left: 0px;" name="stLframe" class="stLframe" id="stLframe" allowtransparency="true" frameborder="0" height="350px" scrolling="no" width="353px"></iframe></div><div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/xd_arbiter.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_http" allowtransparency="true" name="fb_xdm_frame_http" frameborder="0" scrolling="no"></iframe><iframe src="Hardening%20node.js%20for%20production%20part%203:%20zero%20downtime%20deployments%20with%20nginx%20%7C%20Arg%21%20Team%20Blog_files/xd_arbiter_002.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" allowtransparency="true" name="fb_xdm_frame_https" frameborder="0" scrolling="no"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div></body></html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced
Database Caching 1/24 queries in 0.034 seconds using disk: basic

Served from: blog.argteam.com @ 2013-05-07 15:27:25 -->