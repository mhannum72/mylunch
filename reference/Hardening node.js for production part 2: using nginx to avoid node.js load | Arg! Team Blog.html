<!DOCTYPE html>
<!--[if IEMobile 7 ]><html id="blaskan" class="no-js iem7" dir="ltr" lang="en-US"><![endif]-->
<!--[if lt IE 7 ]><html id="blaskan" class="no-js ie6" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 7 ]><html id="blaskan" class="no-js ie7" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 8 ]><html id="blaskan" class="no-js ie8" dir="ltr" lang="en-US"><![endif]-->
<!--[if IE 9 ]><html id="blaskan" class="no-js ie9" dir="ltr" lang="en-US"><![endif]-->
<!--[if (gt IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html id="blaskan" class=" js no-flexbox canvas canvastext no-webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" dir="ltr" lang="en-US"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>Hardening node.js for production part 2: using nginx to avoid node.js load | Arg! Team Blog</title>
	
		<style type="text/css">
		/**
		 * Bulletproof syntax:
		 * http://www.fontspring.com/blog/further-hardening-of-the-bulletproof-syntax
		 * Font files generated by Font Squirrel:
		 * http://www.fontsquirrel.com
		 * License: Open Font License. See http://blog.argteam.com/wp-content/themes/blaskan/OFL.txt.
		 */
		@font-face {
			font-family: 'LeagueGothic';
			src: url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.eot'); /* IE9 Compat Modes */
			src: url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.eot?iefix') format('eot'), /* IE6-IE8 */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.woff') format('woff'), /* Modern Browsers */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.ttf')  format('truetype'), /* Safari, Android, iOS */
			     url('http://blog.argteam.com/wp-content/themes/blaskan/fonts/league_gothic-webfont.svg#webfont3nLbXkSC') format('svg'); /* Legacy iOS */
		}
		</style>
		<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Feed" href="http://blog.argteam.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Comments Feed" href="http://blog.argteam.com/comments/feed/">

			<script src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/a_002.html" async=""></script><script async="" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/cbgapi.loaded_0"></script><script src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/all.js" id="facebook-jssdk"></script><script src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
			// Google Analytics for WordPress by Yoast v4.2.5 | http://yoast.com/wordpress/google-analytics/
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-25938904-1']);
							_gaq.push(['_trackPageview']);
			(function () {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();
			//]]></script>
			<link rel="alternate" type="application/rss+xml" title="Arg! Team Blog » Hardening node.js for production part 2: using nginx to avoid node.js load Comments Feed" href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/feed/">
<link rel="stylesheet" id="blaskan-framework-css" href="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/framework.css" type="text/css" media="screen">
<link rel="stylesheet" id="blaskan-style-css" href="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/style.css" type="text/css" media="screen">
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/modernizr.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/jquery.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/jquery_002.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/helper.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var objectL10n = {"blaskan_navigation_title":"- Navigation -"};
/* ]]> */
</script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/script.js"></script>
<link rel="prev" title="Silly Face Society – The Menu" href="http://blog.argteam.com/sillyfacesociety/silly-face-society-the-menu/">
<link rel="next" title="Silly Face Society – Arthur Says Hello" href="http://blog.argteam.com/sillyfacesociety/silly-face-society-arthur-says-hello/">
<link rel="canonical" href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/">
<link rel="shortlink" href="http://blog.argteam.com/?p=134">
<script charset="utf-8" type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'wp.ed3d2e2e-e1f3-4bd1-b15f-d64d8edf9321'});var st_type='wordpress3.4.1';</script><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">
<link rel="pingback" href="http://blog.argteam.com/xmlrpc.php">
<link href="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/shCore.css" type="text/css" rel="stylesheet"><link href="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/shThemeDefault.css" type="text/css" rel="stylesheet"><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3">
	<script src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/embed.js" async="" type="text/javascript"></script><script src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/checkOAuth.esi" type="text/javascript"></script><link href="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/buttons.css" type="text/css" rel="stylesheet"><script src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/getCount2.html" type="text/javascript"></script><script gapi_processed="true" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/plusone.js" type="text/javascript"></script><script charset="UTF-8" async="" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/alfie.js"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border-spacing:0;border:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
/* @noflip */
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
/* @noflip */
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
/* @noflip */
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
/* @noflip */
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;left:-10000px;overflow:visible;position:absolute;top:-10000px;width:100%
}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0 0, 0 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0 0, 0 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}
.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_fluid span{width:100%}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
/* @noflip */
.fbpluginrecommendationsbarleft{left:10px}
/* @noflip */
.fbpluginrecommendationsbarright{right:10px}</style></head>
<body onclick="if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100);}" class="single single-post postid-134 single-format-standard header-image no-menu content-wide sidebar content-wide-sidebar">
<div id="site">
	<div id="wrapper">
		<header id="header" role="banner">
		  <figure><a href="http://blog.argteam.com/" title="Arg! Team Blog" rel="home"><img src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/cropped-sfs_fb.png" alt="Arg! Team Blog" height="160" width="830"></a></figure><div id="site-name"><a href="http://blog.argteam.com/" title="Arg! Team Blog" rel="home">Arg! Team Blog</a></div><div id="header-message"><a href="http://www.argteam.com/">Arg! Team</a>: purveyors of the finest <a href="http://www.sillyfacesociety.com/">silly faces</a>.</div>		</header>
		<!-- / #header -->
				
		<section id="content" role="main">
			

	
			
		<article id="post-134" class="post-134 post type-post status-publish format-standard hentry category-coding category-http category-node-js">
			<header>
								
			  				  <time datetime="2012-07-08T16:50:39+00:00" pubdate="">July 8, 2012</time>
								
									<h1>Hardening node.js for production part 2: using nginx to avoid node.js load</h1>
							</header>
		
			<div class="content">
				<p>This is part 2 of a quasi-series on hardening node.js for production systems (e.g. the <a href="http://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">Silly Face Society</a>). The previous <a href="http://blog.argteam.com/coding/hardening-nodejs-production-process-supervisor/">article</a>
 covered a process supervisor that creates multiple node.js processes, 
listening on different ports for load balancing. This article will focus
 on HTTP: how to lighten the incoming load on node.js processes. <strong> Update</strong>: I’ve also posted a <a href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-3-zero-downtime-deployments-with-nginx/">part 3</a> on zero downtime deployments in this setup.</p>
<p>Our stack consists of <a href="http://nginx.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://nginx.org']);">nginx</a> serving external traffic by proxying to upstream node.js processes running <a href="http://expressjs.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://expressjs.com']);">express.js</a>.
 As I’ll explain, nginx is used for almost everything: gzip encoding, 
static file serving, HTTP caching, SSL handling, load balancing and 
spoon feeding clients. The idea is use nginx to prevent unnecessary 
traffic from hitting our node.js processes. Furthermore, we remove as 
much overhead as possible for traffic that has to hit node.js. </p>
<p>Too much talk. Here is our nginx config: </p>
<div><div id="highlighter_483325" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_cache_path&nbsp; /var/cache/nginx levels=1:2 keys_zone=one:8m max_size=3000m inactive=600m;</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_temp_path /var/tmp;</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mime.types;</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">default_type&nbsp; application/octet-stream;</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">sendfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">keepalive_timeout&nbsp; 65;</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip on;</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_comp_level 6;</code></div><div class="line number11 index10 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_vary on;</code></div><div class="line number12 index11 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_min_length&nbsp; 1000;</code></div><div class="line number13 index12 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_proxied any;</code></div><div class="line number14 index13 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_types
 text/plain text/html text/css application/json application/x-javascript
 text/xml application/xml application/xml+rss text/javascript;</code></div><div class="line number15 index14 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_buffers 16 8k;</code></div><div class="line number16 index15 alt1"><code class="plain spaces">&nbsp;</code>&nbsp;</div><div class="line number17 index16 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">upstream silly_face_society_upstream {</code></div><div class="line number18 index17 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server 127.0.0.1:61337;</code></div><div class="line number19 index18 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server 127.0.0.1:61338;</code></div><div class="line number20 index19 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">keepalive 64;</code></div><div class="line number21 index20 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server {</code></div><div class="line number24 index23 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">listen 80;</code></div><div class="line number25 index24 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">listen 443 ssl;</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_certificate /some/location/sillyfacesociety.com.bundle.crt;</code></div><div class="line number28 index27 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_certificate_key /some/location/sillyfacesociety.com.key;</code></div><div class="line number29 index28 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_protocols&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SSLv3 TLSv1;</code></div><div class="line number30 index29 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_ciphers HIGH:!aNULL:!MD5;</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server_name sillyfacesociety.com www.sillyfacesociety.com;</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">if ($host = 'sillyfacesociety.com' ) {</code></div><div class="line number35 index34 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">rewrite&nbsp; ^/(.*)$&nbsp; <a href="http://www.sillyfacesociety.com/">http://www.sillyfacesociety.com/</a>$1&nbsp; permanent;</code></div><div class="line number36 index35 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">error_page 502&nbsp; /errors/502.html;</code></div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location ~ ^/(images/|img/|javascript/|js/|css/|stylesheets/|flash/|media/|static/|robots.txt|humans.txt|favicon.ico) {</code></div><div class="line number41 index40 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">root /usr/local/silly_face_society/node/public;</code></div><div class="line number42 index41 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">access_log off;</code></div><div class="line number43 index42 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">expires max;</code></div><div class="line number44 index43 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number45 index44 alt2">&nbsp;</div><div class="line number46 index45 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location /errors {</code></div><div class="line number47 index46 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">internal;</code></div><div class="line number48 index47 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">alias /usr/local/silly_face_society/node/public/errors;</code></div><div class="line number49 index48 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location / {</code></div><div class="line number52 index51 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_redirect off;</code></div><div class="line number53 index52 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-Real-IP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remote_addr;</code></div><div class="line number54 index53 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-Forwarded-For&nbsp; $proxy_add_x_forwarded_for;</code></div><div class="line number55 index54 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-Forwarded-Proto $scheme;</code></div><div class="line number56 index55 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp;
 
Host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 $http_host;</code></div><div class="line number57 index56 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-NginX-Proxy&nbsp;&nbsp;&nbsp; true;</code></div><div class="line number58 index57 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; Connection "";</code></div><div class="line number59 index58 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_http_version 1.1;</code></div><div class="line number60 index59 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_cache one;</code></div><div class="line number61 index60 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_cache_key sfs$request_uri$scheme;</code></div><div class="line number62 index61 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_pass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://silly_face_society_upstream;/">http://silly_face_society_upstream;</a></code></div><div class="line number63 index62 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number64 index63 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number65 index64 alt2"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Also available as a <a href="https://gist.github.com/3072833" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://gist.github.com']);">gist</a>.</p>
<p>Perhaps this code dump isn’t particularly enlightening: I’ll try to 
step through the config and give pointers on how this balances the 
express.js code.</p>
<p><strong> The nginx &lt;-&gt; node.js link </strong><br>
First things first: how can we get nginx to proxy / load balance traffic
 to our node.js instances? We’ll assume that we are running two 
instances of express.js on ports 61337 and 61338. Take a look at the <code>upstream</code> section:</p>
<div><div id="highlighter_498619" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">upstream silly_face_society_upstream {</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server 127.0.0.1:61337;</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server 127.0.0.1:61338;</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">keepalive 64;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number9 index8 alt2"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The <a href="http://wiki.nginx.org/HttpUpstreamModule" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">upstream</a> directive specifies that these two instances work in tandem as an upstream server for nginx. The <code>keepalive 64;</code> directs nginx to keep a <em>minimum</em>
 of 64 HTTP/1.1 connections to the proxy server at any given time. This 
is a true minimum: if there is more traffic then nginx will open more 
connections to the proxy.</p>
<p><code>upstream</code> alone is not sufficient – nginx needs to know <em>how and when</em> to route traffic to node. The magic happens within our <code>server</code> section. Scrolling to the bottom, we have a <code>location /</code> section like:</p>
<div><div id="highlighter_796700" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server {</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location / {</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_redirect off;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-Real-IP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remote_addr;</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-Forwarded-For&nbsp; $proxy_add_x_forwarded_for;</code></div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp;
 
Host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 $http_host;</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-NginX-Proxy&nbsp;&nbsp;&nbsp; true;</code></div><div class="line number11 index10 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number12 index11 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; Connection "";</code></div><div class="line number13 index12 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_http_version 1.1;</code></div><div class="line number14 index13 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_pass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://silly_face_society_upstream;/">http://silly_face_society_upstream;</a></code></div><div class="line number15 index14 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number16 index15 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number17 index16 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number18 index17 alt1"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>This section is a fall-through for traffic that hasn’t matched any 
other rules: we have node.js handle the traffic and nginx proxy the 
response. The most important part of the section is <code>proxy_pass</code> – this tells nginx to use the <code>upstream</code> server that we defined higher up in the config. Next in line is <code> proxy_http_version</code>
 which tells nginx that it should use HTTP/1.1 for connections to the 
proxy server. Using HTTP/1.1 spares the overhead of establishing a 
connection between nginx and node.js with every proxied request and has a
 significant impact on response latency. Finally, we have a couple of <code>proxy_set_header</code>
 directives to tell our express.js processes that this is a proxied 
request and not a direct one. Full explanations can be found in the <a href="http://wiki.nginx.org/HttpProxyModule" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">HttpProxyModule</a> docs.</p>
<p>This part of the config is the minimum amount needed to get nginx 
serving port 80 and proxying our node.js processes underneath. The rest 
of this article will cover how to use nginx features to lighten the 
traffic load on node.js.</p>
<p><strong>Static file intercept</strong><br>
Although express.js has built in static file handling through some 
connect middleware, you should never use it. Nginx can do a much better 
job of handling static files and can prevent requests for non-dynamic 
content from clogging our node processes. The <code>location</code> directive in question is:</p>
<div><div id="highlighter_443359" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server {</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location ~ ^/(images/|img/|javascript/|js/|css/|stylesheets/|flash/|media/|static/|robots.txt|humans.txt|favicon.ico) {</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">root /usr/local/silly_face_society/node/public;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">access_log off;</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">expires max;</code></div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number11 index10 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number12 index11 alt1"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Any requests for with a URI starting with <code>images, img, css, js, ...</code> will be matched by this location. In my express.js directory structure, the <code>public/</code> directory is used to store all my static assets – things like CSS, javascript and the like. Using <code>root</code> I instruct nginx to serve these files without ever talking to the underlying servers. The <code>expires max;</code>
 section is a caching hint that these assets are immutable. For other 
sites, it may be more appropriate to use a quicker cache expiry through 
something like <code> expires 1h;</code>. Full information can be in nginx’s <a href="http://wiki.nginx.org/HttpHeadersModule" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">HttpHeadersModule</a>.</p>
<p><strong>Caching</strong><br>
In my opinion, any caching is better than no caching. Sites with 
extremely heavy traffic will use all kinds of caching solutions 
including <a href="https://www.varnish-cache.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.varnish-cache.org']);">varnish</a> for HTTP acceleration and <a href="http://memcached.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://memcached.org']);">memcached</a>
 for fragment caching and query caching. Our site isn’t so high-traffic 
but caching is still going to save us a fortune in server costs. For 
simplicity of configuration I decided to use nginx’s built-in caching.</p>
<p>Nginx’s built in caching is crude: when an upstream server provides HTTP header hints like <code>Cache-Control</code>,
 it enables caching with an expiry time matching the header hint. Within
 the expiry time, the next request will pull a cached file from disk 
instead of hitting the underlying node.js process. To set up caching, I 
have set two directives in the <code>http</code> section of the nginx config:
</p><div><div id="highlighter_281414" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_cache_path&nbsp; /var/cache/nginx levels=1:2 keys_zone=one:8m max_size=3000m inactive=600m;</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_temp_path /var/tmp;</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number6 index5 alt1"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>These two lines instruct nginx that we are going to use it in caching mode. <code>proxy_cache_path</code> specifies the root directory for our cache, the directory-depth (<code>levels</code>), the <code>max_size</code> of the cache and the <code>inactive</code> expire time. More importantly, it specifies the size of the in-memory keys for the files through <code>keys_zone</code>.
 When nginx receives a request, it computes an MD5 hash and uses this 
key set to find the corresponding file on disk. If it is not available, 
the request will hit our underlying node.js processes. Finally, to make 
our proxied requests use this cache, we have to change the <code>location /</code> section to include some caching information:</p>
<div><div id="highlighter_280018" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;</code><code class="plain plain">server {</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location / {</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_cache one;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_cache_key sfs$request_uri$scheme;</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number11 index10 alt2"><code class="plain spaces">&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number12 index11 alt1"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>This instructs nginx that it can use our <code>one</code> keys_set to cache incoming requests. MD5 hashes will be computed using the <code>proxy_cache_key</code></p>
<p>We have one miss: express.js will not be serving the proper HTTP 
cache hint headers. I wrote a quick piece of middleware that will 
provide this functionality.</p>
<div><div id="highlighter_206830" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript variable bold">cacheMiddleware </code><code class="coffeescript keyword">=</code> <code class="coffeescript variable bold">cacheMiddleware </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">seconds</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">req, res, next</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number2 index1 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">res.setHeader </code><code class="coffeescript string">"Cache-Control"</code><code class="coffeescript plain">, </code><code class="coffeescript string">"public, max-age=#{seconds}"</code></div><div class="line number3 index2 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="coffeescript plain">next</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>It is not appropriate to apply this middleware globally – certain 
requests (e.g. post requests that affect server state) should never be 
cached. As such, I use it on a per-route basis in my express.js app:</p>
<div><div id="highlighter_649867" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript keyword">...</code></div><div class="line number2 index1 alt1"><code class="coffeescript plain">app.get </code><code class="coffeescript string">"/recent"</code><code class="coffeescript plain">, cacheMiddleware</code><code class="coffeescript keyword">(</code><code class="coffeescript value">5</code> <code class="coffeescript keyword">*</code> <code class="coffeescript value">60</code><code class="coffeescript keyword">)</code><code class="coffeescript plain">, </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">req, res, next</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number3 index2 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript comments">#When someone hits /recent, nginx will cache it for 5 minutes!</code></div><div class="line number4 index3 alt1"><code class="coffeescript keyword">...</code></div></div></td></tr></tbody></table></div></div>
<p><strong>GZIP</strong><br>
GZIP is a no-brainer for HTTP. By compressing incoming requests, clients
 will spend less time hogging up your server and everyone saves money on
 bandwidth. You could use some express.js middleware to handle gzipping 
of outgoing requests but nginx will do a better job and leave express.js
 with more resources. To enable GZIPed requests in nginx, add the 
following lines to the <code>http</code> section:</p>
<div><div id="highlighter_696152" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip on;</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_comp_level 6;</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_vary on;</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_min_length&nbsp; 1000;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_proxied any;</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_types
 text/plain text/html text/css application/json application/x-javascript
 text/xml application/xml application/xml+rss text/javascript;</code></div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">gzip_buffers 16 8k;</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number11 index10 alt2"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>I won’t go into details on what these directives do. Like caching, 
any gzip is better than no gzip. For more control, there are a thousand 
micro-optimizations that you can perform that are all documented well 
under nginx’s <a href="http://wiki.nginx.org/HttpGzipModule" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">HttpGzipModule</a>.</p>
<p><strong>SSL</strong><br>
Continuing our theme of leaving node.js to handle only basic HTTP, we 
arrive at SSL. As long as upstream servers are within a trusted network,
 it doesn’t make sense to encrypt traffic further than nginx – node.js 
can serve HTTP traffic for nginx to encrypt. This setup is easy to 
configure; in the server directive you can tell nginx how to configure 
SSL:</p>
<div><div id="highlighter_646359" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server {</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">listen 443 ssl;</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_certificate /some/location/sillyfacesociety.com.bundle.crt;</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_certificate_key /some/location/sillyfacesociety.com.key;</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_protocols&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SSLv3 TLSv1;</code></div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">ssl_ciphers HIGH:!aNULL:!MD5;</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number11 index10 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number12 index11 alt1"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p><code>listen</code> tells nginx to enable SSL traffic. <code>ssl_certificate</code> and <code>ssl_certificate_key</code> tell nginx where to find the certificates for your server. The <code>ssl_protocols</code> and <code>ssl_ciphers</code> lines instruct<br>
nginx on how to serve traffic. These are details: full configuration options are available in the nginx <a href="http://wiki.nginx.org/HttpSslModule" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">HttpSslModule</a>.</p>
<p>We are almost there. The above configuration will get nginx 
decrypting traffic and proxying unecrypted requests to our upstream 
server. However, the upstream server may need to know whether it is in a
 secure context or not. This can be used to serve SSL-enabled assets 
from CDNs like Cloudfront, or to reject requests that come unencrypted. 
Add the following lines to the <code>location /</code> section:</p>
<div><div id="highlighter_30183" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">http {</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain plain">server {</code></div><div class="line number4 index3 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">location / {</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">proxy_set_header&nbsp;&nbsp; X-Forwarded-Proto $scheme;</code></div><div class="line number8 index7 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">...</code></div><div class="line number9 index8 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number10 index9 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number11 index10 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain plain">}</code></div><div class="line number12 index11 alt1"><code class="plain plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>This will send an HTTP header hint down to your node.js processes. 
Again, I whipped up a bit of middleware that make SSL-detection a little
 bit easier:</p>
<div><div id="highlighter_815633" class="syntaxhighlighter  coffeescript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="coffeescript plain">app.use </code><code class="coffeescript keyword">(</code><code class="coffeescript plain">req, res, next</code><code class="coffeescript keyword">)</code> <code class="coffeescript keyword">-&gt;</code></div><div class="line number2 index1 alt1"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript variable bold">req.forwardedSecure </code><code class="coffeescript keyword">=</code> <code class="coffeescript keyword">(</code><code class="coffeescript plain">req.headers</code><code class="coffeescript keyword">[</code><code class="coffeescript string">"x-forwarded-proto"</code><code class="coffeescript keyword">]</code> <code class="coffeescript keyword">==</code> <code class="coffeescript string">"https"</code><code class="coffeescript keyword">)</code></div><div class="line number3 index2 alt2"><code class="coffeescript spaces">&nbsp;&nbsp;</code><code class="coffeescript plain">next</code><code class="coffeescript keyword">(</code><code class="coffeescript keyword">)</code></div></div></td></tr></tbody></table></div></div>
<p>Within your routes, <code>req.forwardedSecure</code> will be true iff
 nginx is handling HTTPS traffic. For reference, the silly face society 
uses SSL for Facebook authentication token exchange when a user logs in 
using SSO (single sign on) on their phone. As an extension of 
implementing this, I also threw up a secure version of the site <a href="https://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">here</a>.</p>
<p><strong>Wrapping up</strong><br>
Phew. We covered how to (1) set up node.js as an upstream server for 
nginx and (2) how to lighten the load on the upstream server by letting 
nginx handle load balancing, static files, SSL, GZIP and caching. <em>Caveat emptor:</em>
 the silly face society hasn’t launched yet. The above configuration is 
based on personal testing and research: we haven’t reached 
production-level traffic yet. If anyone is still reading, I welcome 
suggestions for improvements in the comments.</p>
<p>Incidentally, our use of express.js for HTTP traffic is an accident. 
We started using node.js to provide a socket-server for the real time 
“party mode” of the silly face society. As we got close to launching, we
 decided to add a <a href="http://itunes.apple.com/us/app/draw-something-free/id488628250?mt=8" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://itunes.apple.com']);">Draw Something</a>-esque
 passive mode so that the Silly Face Society could have the launch 
inertia to be successful. Instead of rewriting our technology stack, we 
reused as much of the old code as possible and exposed an HTTP 
interface. If I had to do it all from scratch, I would re-evaluate our 
choices: node.js is a hard beast to tame for CRUD-apps.</p>
<p>Does your interest in nginx align with your interest in silly faces? Try out the <a href="http://www.sillyfacesociety.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sillyfacesociety.com']);">Silly Face Society</a> on the iPhone.</p>
<p><span st_processed="yes" class="st_facebook_hcount" st_title="Hardening node.js for production part 2: using nginx to avoid node.js load" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/" displaytext="facebook"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/facebook_counter.png&quot;);" class="stMainServices st-facebook-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">23</span></span></span></span></span></span><span st_processed="yes" st_via="cosbynator" class="st_twitter_hcount" st_title="Hardening node.js for production part 2: using nginx to avoid node.js load" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/" displaytext="twitter"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/twitter_counter.png&quot;);" class="stMainServices st-twitter-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">205</span></span></span></span></span></span><span st_processed="yes" class="st_email_hcount" st_title="Hardening node.js for production part 2: using nginx to avoid node.js load" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/" displaytext="email"><span class="stButton" style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;"><span><span style="background-image: url(&quot;http://w.sharethis.com/images/email_counter.png&quot;);" class="stMainServices st-email-counter">&nbsp;<img style="position: absolute; top: -7px; right: -7px; width: 19px; height: 19px; max-width: 19px; max-height: 19px; display: none;" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/check-big.png"></span><span class="stArrow"><span style="display: inline-block;" class="stButton_gradient stHBubble"><span class="stBubble_hcount">5</span></span></span></span></span></span><span st_processed="yes" class="st_plusone_hcount" st_title="Hardening node.js for production part 2: using nginx to avoid node.js load" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/" displaytext="plusone"><div style="display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:75px; height:21px;">&nbsp;<div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px;"><iframe title="+1" data-gapiattached="true" allowtransparency="true" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/fastbutton.html" name="I0_1367963499463" id="I0_1367963499463" vspace="0" tabindex="0" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" marginwidth="0" marginheight="0" hspace="0" frameborder="0" scrolling="no" width="100%"></iframe></div></div></span><span st_processed="yes" class="st_fblike_hcount" st_title="Hardening node.js for production part 2: using nginx to avoid node.js load" st_url="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/" displaytext="fblike"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;padding:0px;font-size:11px;line-height:16px;vertical-align:bottom;overflow:visible;"><div fb-xfbml-state="rendered" data-href="http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/" class="fb-like fb_edge_widget_with_comment fb_iframe_widget" data-show-faces="false" data-layout="button_count" data-send="false" data-action=""><span style="height: 21px; width: 73px;"><iframe src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/like.html" class="fb_ltr" title="Like this content on Facebook." style="border: medium none; overflow: hidden; height: 21px; width: 73px;" name="f35ebee89c9903e" id="fbb81f880d1ee6" scrolling="no"></iframe></span></div></span></span></p>					
					
			</div>
			<!-- / .content -->
			
			<footer>
			  				  <span class="author"><span class="author-label">Written by</span> <a href="http://blog.argteam.com/author/thomas-dimson/" title="Posts by Thomas Dimson" rel="author">Thomas Dimson</a></span>
																	<span class="categories">
						<span class="categories-label">Posted in</span> <a href="http://blog.argteam.com/category/coding/" title="View all posts in coding" rel="category tag">coding</a>, <a href="http://blog.argteam.com/category/http/" title="View all posts in http" rel="category tag">http</a>, <a href="http://blog.argteam.com/category/node-js/" title="View all posts in node.js" rel="category tag">node.js</a>					</span>
												
							</footer>
		</article>
		<!-- / #post-134 -->

		
<div id="disqus_thread"><iframe verticalscrolling="no" horizontalscrolling="no" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/a.html" style="width: 100%; border: medium none; overflow: hidden; height: 3536px;" role="complementary" allowtransparency="true" data-disqus-uid="1" id="dsq1" frameborder="0" scrolling="no" width="100%"></iframe><iframe src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/client.html" style="width: 100%; border: medium none; overflow: hidden; display: none;" role="application" allowtransparency="true" data-disqus-uid="2" id="dsq2" frameborder="0" width="100%"></iframe><iframe style="width: 830px; border: medium none; overflow: hidden; top: 0px; min-width: 830px; max-width: 830px; position: fixed; max-height: 29px; min-height: 29px; height: 29px; display: none;" role="alert" allowtransparency="true" data-disqus-uid="-indicator-north" id="dsq-indicator-north" frameborder="0" scrolling="no"></iframe><iframe style="width: 830px; border: medium none; overflow: hidden; bottom: 0px; min-width: 830px; max-width: 830px; position: fixed; max-height: 29px; min-height: 29px; height: 29px; display: none;" role="alert" allowtransparency="true" data-disqus-uid="-indicator-south" id="dsq-indicator-south" frameborder="0" scrolling="no"></iframe></div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://blog.argteam.com/coding/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load/';
    var disqus_identifier = '134 http://blog.argteam.com/?p=134';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'argteamblog';
    var disqus_title = "Hardening node.js for production part 2: using nginx to avoid node.js load";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=134';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
    var facebookXdReceiverPath = 'http://blog.argteam.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
            {
                'author_name':    "Sysadmin Sunday 88 | Server Density Blog",
                'author_url':    "http:\/\/blog.serverdensity.com\/2012\/07\/15\/sysadmin-sunday-88\/",
                'date':            "07\/15\/2012 09:01 AM",
                'excerpt':        "[...] Hardening node.js for production part 2: using nginx to avoid node.js load [...] ",
                'type':            "pingback"            }
,            {
                'author_name':    "nginx as a proxy server: farming &amp; failover of a node.js app | I can haz cøde",
                'author_url':    "http:\/\/icanhazcode.wordpress.com\/2012\/09\/12\/nginx-as-a-proxy-server-farming-failover-of-a-node-js-app\/",
                'date':            "09\/12\/2012 01:31 AM",
                'excerpt':        "[...] for the terms &#8220;nodejs redis architecture&#8221; or something like that, when I ran into this great post by the ...",
                'type':            "pingback"            }
        ],
        'trackback_url': "http:\/\/blog.argteam.com\/coding\/hardening-node-js-for-production-part-2-using-nginx-to-avoid-node-js-load\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
        dsq.src = 'http' + '://' + disqus_shortname + '.' + 'disqus.com' + '/embed.js?pname=wordpress&pver=2.73';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
		
				  <nav class="post-nav" role="navigation">
				<div class="nav-previous"><a href="http://blog.argteam.com/sillyfacesociety/silly-face-society-the-menu/" rel="prev"><span class="meta-nav"></span> Silly Face Society – The Menu</a></div>
				<div class="nav-next"><a href="http://blog.argteam.com/sillyfacesociety/silly-face-society-arthur-says-hello/" rel="next">Silly Face Society – Arthur Says Hello <span class="meta-nav"></span></a></div>
			</nav>
			<!-- / .post-nav -->
				
		

		</section>
		<!-- / #content -->
		
		
					<aside id="primary" role="complementary">
				<section id="text-4" class="widget widget_text">			<div class="textwidget"><a href="http://blog.argteam.com/feed/">Feed</a>
<br>
<br>
<a href="http://www.twitter.com/cosbynator" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.twitter.com']);">@cosbynator</a>
<br>
<a href="http://www.twitter.com/_toastar" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.twitter.com']);">@_toastar</a></div>
		</section><section id="archives-3" class="widget widget_archive"><h3 class="title">Oldies</h3>		<ul>
			<li><a href="http://blog.argteam.com/2012/10/" title="October 2012">October 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/09/" title="September 2012">September 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/08/" title="August 2012">August 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/07/" title="July 2012">July 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/06/" title="June 2012">June 2012</a></li>
	<li><a href="http://blog.argteam.com/2012/01/" title="January 2012">January 2012</a></li>
	<li><a href="http://blog.argteam.com/2011/12/" title="December 2011">December 2011</a></li>
	<li><a href="http://blog.argteam.com/2011/11/" title="November 2011">November 2011</a></li>
		</ul>
</section>		</aside>
		<!-- / #primary -->
    			
		
		<footer id="footer">
			<div id="footer-info" role="contentinfo"><div id="footer-message">Route complaints to <a href="https://twitter.com/cosbynator">@cosbynator</a> or <a href="https://twitter.com/_toastar">@_toastar</a></div><div id="footer-credits">Powered by <a href="http://www.blaskan.net/">Blaskan</a> and <a href="http://www.wordpress.org/">WordPress</a>.</div></div>		</footer>
		<!-- / #footer -->
	</div>
	<!-- / #wrapper -->
</div>
<!-- / #site -->


	<script>
	MBP.scaleFix();
	MBP.hideUrlBar();
	</script>
	<!--[if (lt IE 9) & (!IEMobile)]>
<script type="text/javascript" src="http://blog.argteam.com/wp-content/themes/blaskan/js/libs/selectivizr.1.0.3b.js"></script>
<script type="text/javascript" src="http://blog.argteam.com/wp-content/themes/blaskan/js/libs/respond.min.js"></script>
<![endif]-->
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/shCore.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/shBrushPlain.js"></script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/shBrushCoffeeScript.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://blog.argteam.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://blog.argteam.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['tab-size'] = 2;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/comment-reply.js"></script>


<iframe style="display:none;" src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/getSegment.html" name="stSegmentFrame" id="stSegmentFrame" frameborder="0" height="0px" scrolling="no" width="0px"></iframe><div style="visibility: hidden; top: -999px; left: -999px;" class="stwrapper" id="stwrapper"><div class="stclose"></div><iframe src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/index.html" style="top: 0px; left: 0px;" name="stLframe" class="stLframe" id="stLframe" allowtransparency="true" frameborder="0" height="350px" scrolling="no" width="353px"></iframe></div><div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/xd_arbiter.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_http" allowtransparency="true" name="fb_xdm_frame_http" frameborder="0" scrolling="no"></iframe><iframe src="Hardening%20node.js%20for%20production%20part%202:%20using%20nginx%20to%20avoid%20node.js%20load%20%7C%20Arg%21%20Team%20Blog_files/xd_arbiter_002.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" allowtransparency="true" name="fb_xdm_frame_https" frameborder="0" scrolling="no"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div></body></html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced
Database Caching 1/29 queries in 0.014 seconds using disk: basic

Served from: blog.argteam.com @ 2013-05-07 13:22:37 -->